# üìß Telegram Gmail Bot

Telegram –±–æ—Ç –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–æ–ª—É—á–µ–Ω–∏—è –∫–æ–¥–æ–≤ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏–∑ Gmail —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –ø–æ—á—Ç–æ–≤—ã—Ö –∞–∫–∫–∞—É–Ω—Ç–æ–≤.

## üöÄ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –Ω–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ Gmail –∞–∫–∫–∞—É–Ω—Ç–æ–≤
- ‚úÖ –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–¥–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ —á–µ—Ä–µ–∑ Gmail Push Notifications
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –∫–æ–¥–æ–≤ –∏–∑ –ø–∏—Å–µ–º (—Ü–∏—Ñ—Ä–æ–≤—ã–µ –∏ –±—É–∫–≤–µ–Ω–Ω–æ-—Ü–∏—Ñ—Ä–æ–≤—ã–µ)
- ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è OAuth2 –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
- ‚úÖ –•—Ä–∞–Ω–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤ –≤ MongoDB
- ‚úÖ –ü—Ä–æ—Å—Ç–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∞–∫–∫–∞—É–Ω—Ç–∞–º–∏

## üìã –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Node.js >= 16.x
- MongoDB >= 4.x
- Google Cloud Platform –∞–∫–∫–∞—É–Ω—Ç
- Telegram Bot Token

## üõ† –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

\`\`\`bash
# –£—Å—Ç–∞–Ω–æ–≤–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
npm install
\`\`\`

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Google Cloud Platform

#### –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞ –∏ OAuth credentials:

1. –ü–µ—Ä–µ–π–¥–∏ –≤ [Google Cloud Console](https://console.cloud.google.com)
2. –°–æ–∑–¥–∞–π –Ω–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç
3. –í–∫–ª—é—á–∏ **Gmail API**:
   - APIs & Services ‚Üí Library ‚Üí Gmail API ‚Üí Enable
4. –ù–∞—Å—Ç—Ä–æ–π OAuth consent screen:
   - APIs & Services ‚Üí OAuth consent screen
   - –í—ã–±–µ—Ä–∏ "External" (–∏–ª–∏ Internal –¥–ª—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏)
   - –ó–∞–ø–æ–ª–Ω–∏ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è
   - –î–æ–±–∞–≤—å —Ç–µ—Å—Ç–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (—Å–≤–æ–∏ Gmail –∞–∫–∫–∞—É–Ω—Ç—ã)
5. –°–æ–∑–¥–∞–π OAuth 2.0 Client ID:
   - APIs & Services ‚Üí Credentials ‚Üí Create Credentials ‚Üí OAuth 2.0 Client ID
   - –¢–∏–ø: **Desktop app**
   - –°–∫–∞—á–∞–π JSON —Ñ–∞–π–ª –∏ –ø–µ—Ä–µ–∏–º–µ–Ω—É–π –≤ \`credentials.json\`
   - –ü–æ–ª–æ–∂–∏ —Ñ–∞–π–ª –≤ –∫–æ—Ä–µ–Ω—å –ø—Ä–æ–µ–∫—Ç–∞

#### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Cloud Pub/Sub:

1. –í–∫–ª—é—á–∏ **Cloud Pub/Sub API**:
   - APIs & Services ‚Üí Library ‚Üí Cloud Pub/Sub API ‚Üí Enable

2. –°–æ–∑–¥–∞–π Topic:
   - Pub/Sub ‚Üí Topics ‚Üí Create Topic
   - –ù–∞–∑–≤–∞–Ω–∏–µ: \`gmail-notifications\` (–∏–ª–∏ –ª—é–±–æ–µ –¥—Ä—É–≥–æ–µ)
   - –ó–∞–ø–æ–º–Ω–∏ –ø–æ–ª–Ω–æ–µ –∏–º—è: \`projects/YOUR_PROJECT_ID/topics/gmail-notifications\`
                           projects/codegram-473918/topics/gmail-notifications
3. –î–æ–±–∞–≤—å –ø—Ä–∞–≤–∞ –¥–ª—è Gmail:
   - –û—Ç–∫—Ä–æ–π —Å–æ–∑–¥–∞–Ω–Ω—ã–π Topic
   - Permissions ‚Üí Add Principal
   - Principal: \`gmail-api-push@system.gserviceaccount.com\`
   - Role: **Pub/Sub Publisher**

4. –°–æ–∑–¥–∞–π Subscription:
   - Pub/Sub ‚Üí Subscriptions ‚Üí Create Subscription
   - Subscription ID: \`gmail-notifications-sub\`
   - Select a Cloud Pub/Sub topic: –≤—ã–±–µ—Ä–∏ —Å–æ–∑–¥–∞–Ω–Ω—ã–π topic
   - Delivery type: **Push**
   - Endpoint URL: \`https://your-domain.com/gmail-webhook\` (URL —Ç–≤–æ–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞)

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

–°–æ–∑–¥–∞–π —Ñ–∞–π–ª \`.env\` –Ω–∞ –æ—Å–Ω–æ–≤–µ \`.env.example\`:

\`\`\`env
# –ü–æ–ª—É—á–∏ —É @BotFather –≤ Telegram
TELEGRAM_BOT_TOKEN=123456:ABC-DEF1234ghIkl-zyx57W2v1u123ew11

# MongoDB (–ª–æ–∫–∞–ª—å–Ω—ã–π –∏–ª–∏ –æ–±–ª–∞—á–Ω—ã–π)
MONGODB_URI=mongodb://localhost:27017/gmail-bot

# –¢–≤–æ–π Pub/Sub Topic –∏–∑ Google Cloud
PUBSUB_TOPIC=projects/your-project-id/topics/gmail-notifications

# –ü–æ—Ä—Ç –¥–ª—è webhook —Å–µ—Ä–≤–µ—Ä–∞
PORT=3000
\`\`\`

### 4. –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –≤–µ–±—Ö—É–∫–∞

–î–ª—è —Ä–∞–±–æ—Ç—ã Push Notifications –Ω—É–∂–µ–Ω –ø—É–±–ª–∏—á–Ω—ã–π HTTPS URL. –í–∞—Ä–∏–∞–Ω—Ç—ã:

#### –í–∞—Ä–∏–∞–Ω—Ç A: ngrok (–¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)

\`\`\`bash
# –£—Å—Ç–∞–Ω–æ–≤–∏ ngrok
npm install -g ngrok

# –ó–∞–ø—É—Å—Ç–∏ —Ç—É–Ω–Ω–µ–ª—å
ngrok http 3000

# –°–∫–æ–ø–∏—Ä—É–π HTTPS URL –∏ –∏—Å–ø–æ–ª—å–∑—É–π –µ–≥–æ –≤ Pub/Sub Subscription
\`\`\`

#### –í–∞—Ä–∏–∞–Ω—Ç B: VPS/Cloud (–¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞)

1. –†–∞–∑–≤–µ—Ä–Ω–∏ –Ω–∞ VPS (DigitalOcean, AWS, Google Cloud)
2. –ù–∞—Å—Ç—Ä–æ–π NGINX —Å SSL (Let's Encrypt)
3. –ü—Ä–æ–∫—Å–∏—Ä—É–π –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ –ø–æ—Ä—Ç 3000

### 5. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ MongoDB

\`\`\`bash
# Ubuntu/Debian
sudo apt-get install mongodb

# macOS
brew install mongodb-community

# –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π –æ–±–ª–∞—á–Ω—ã–π MongoDB Atlas (–±–µ—Å–ø–ª–∞—Ç–Ω–æ)
# https://www.mongodb.com/cloud/atlas
\`\`\`

## üöÄ –ó–∞–ø—É—Å–∫

\`\`\`bash
# –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞
npm run dev

# –ü—Ä–æ–¥–∞–∫—à–µ–Ω
npm start
\`\`\`

## üì± –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞:

- \`/start\` - –ù–∞—á–∞–ª–æ —Ä–∞–±–æ—Ç—ã
- \`/add\` - –î–æ–±–∞–≤–∏—Ç—å Gmail –∞–∫–∫–∞—É–Ω—Ç
- \`/list\` - –°–ø–∏—Å–æ–∫ –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã—Ö –∞–∫–∫–∞—É–Ω—Ç–æ–≤
- \`/remove\` - –£–¥–∞–ª–∏—Ç—å –∞–∫–∫–∞—É–Ω—Ç
- \`/help\` - –ü–æ–º–æ—â—å

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ Gmail –∞–∫–∫–∞—É–Ω—Ç–∞:

1. –û—Ç–ø—Ä–∞–≤—å \`/add\` –±–æ—Ç—É
2. –ü–µ—Ä–µ–π–¥–∏ –ø–æ —Å—Å—ã–ª–∫–µ –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
3. –í–æ–π–¥–∏ –≤ Gmail –∞–∫–∫–∞—É–Ω—Ç
4. –†–∞–∑—Ä–µ—à–∏ –¥–æ—Å—Ç—É–ø –∫ –ø–æ—á—Ç–µ
5. –°–∫–æ–ø–∏—Ä—É–π –∫–æ–¥ –∏ –æ—Ç–ø—Ä–∞–≤—å –±–æ—Ç—É
6. –ì–æ—Ç–æ–≤–æ! –ö–æ–¥—ã –±—É–¥—É—Ç –ø—Ä–∏—Ö–æ–¥–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è OAuth2 –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
- –¢–æ–∫–µ–Ω—ã —Ö—Ä–∞–Ω—è—Ç—Å—è –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ –≤ MongoDB
- –î–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ –Ω–∞ —á—Ç–µ–Ω–∏–µ –ø–∏—Å–µ–º
- –ö–∞–∂–¥—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ –∞–∫–∫–∞—É–Ω—Ç—ã

## üêõ –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –û—à–∏–±–∫–∞ "credentials.json not found"
- –ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ —Ñ–∞–π–ª \`credentials.json\` –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞
- –£–±–µ–¥–∏—Å—å, —á—Ç–æ —Å–∫–∞—á–∞–ª –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π OAuth 2.0 Client ID (Desktop app)

### –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ MongoDB
- –ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ MongoDB –∑–∞–ø—É—â–µ–Ω: \`sudo systemctl status mongodb\`
- –ü—Ä–æ–≤–µ—Ä—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å MONGODB_URI –≤ .env

### –ö–æ–¥—ã –Ω–µ –ø—Ä–∏—Ö–æ–¥—è—Ç
- –£–±–µ–¥–∏—Å—å, —á—Ç–æ –≤–µ–±—Ö—É–∫ –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ HTTPS
- –ü—Ä–æ–≤–µ—Ä—å Pub/Sub Subscription –∏ –ø—Ä–∞–≤–∞ –¥–ª—è \`gmail-api-push@system.gserviceaccount.com\`
- –ü—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞

### –û—à–∏–±–∫–∞ "Invalid grant"
- –¢–æ–∫–µ–Ω –∏—Å—Ç–µ–∫, —É–¥–∞–ª–∏ –∞–∫–∫–∞—É–Ω—Ç —á–µ—Ä–µ–∑ \`/remove\` –∏ –¥–æ–±–∞–≤—å –∑–∞–Ω–æ–≤–æ

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

\`\`\`
telegram-gmail-bot/
‚îú‚îÄ‚îÄ index.js              # –û—Å–Ω–æ–≤–Ω–æ–π —Ñ–∞–π–ª –±–æ—Ç–∞
‚îú‚îÄ‚îÄ gmailAuth.js          # OAuth2 –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
‚îú‚îÄ‚îÄ gmailWatcher.js       # –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø–∏—Å–µ–º —á–µ—Ä–µ–∑ Pub/Sub
‚îú‚îÄ‚îÄ codeExtractor.js      # –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –∫–æ–¥–æ–≤ –∏–∑ –ø–∏—Å–µ–º
‚îú‚îÄ‚îÄ database.js           # MongoDB –º–æ–¥–µ–ª–∏ –∏ —Ñ—É–Ω–∫—Ü–∏–∏
‚îú‚îÄ‚îÄ credentials.json      # OAuth credentials (–Ω–µ –≤ git)
‚îú‚îÄ‚îÄ package.json          # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îú‚îÄ‚îÄ .env                  # –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (–Ω–µ –≤ git)
‚îî‚îÄ‚îÄ README.md             # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
\`\`\`

## ü§ù –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:
1. –ü—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞
2. –£–±–µ–¥–∏—Å—å, —á—Ç–æ –≤—Å–µ API –≤–∫–ª—é—á–µ–Ω—ã –≤ Google Cloud
3. –ü—Ä–æ–≤–µ—Ä—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Pub/Sub

## üìù –õ–∏—Ü–µ–Ω–∑–∏—è

ISC

## üîó –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- [Gmail API Documentation](https://developers.google.com/gmail/api)
- [Telegram Bot API](https://core.telegram.org/bots/api)
- [Google Cloud Pub/Sub](https://cloud.google.com/pubsub/docs)
- [MongoDB Documentation](https://docs.mongodb.com/)
